name: Parallel Development with Claude Code

on:
  workflow_dispatch:
    inputs:
      tasks:
        description: 'Development tasks to execute in parallel'
        required: true
        type: choice
        options:
          - 'weather-api'
          - 'socket-realtime'
          - 'responsive-design'
          - 'testing-setup'
          - 'all-tasks'
        default: 'all-tasks'
      branch:
        description: 'Branch to work on'
        required: true
        default: 'main'
        type: string

jobs:
  weather-api:
    if: ${{ github.event.inputs.tasks == 'weather-api' || github.event.inputs.tasks == 'all-tasks' }}
    runs-on: ubuntu-latest
    name: Weather API Integration
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: |
            backend/package-lock.json
            frontend/package-lock.json

      - name: Install dependencies
        run: |
          cd backend && npm ci
          cd ../frontend && npm ci

      - name: Run Claude Code for Weather API
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: |
            å¤©æ°—æƒ…å ±APIçµ±åˆã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®è¦ä»¶ã‚’æº€ãŸã—ã¦ãã ã•ã„ï¼š
            1. OpenWeatherMap APIã¨ã®çµ±åˆ
            2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ
            3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§APIã‚’å‘¼ã³å‡ºã™ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ
            4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
            5. ç’°å¢ƒå¤‰æ•°ã§ã®è¨­å®šç®¡ç†
          target-files: |
            backend/src/
            frontend/src/
            shared/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: implement weather API integration"
          title: "Weather API Integration"
          body: |
            ## å¤©æ°—æƒ…å ±APIçµ±åˆ
            
            - OpenWeatherMap APIã¨ã®çµ±åˆã‚’å®Ÿè£…
            - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ
            - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ
            - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
            
            ğŸ¤– Generated with Claude Code via GitHub Actions
          branch: feature/weather-api
          delete-branch: true

  socket-realtime:
    if: ${{ github.event.inputs.tasks == 'socket-realtime' || github.event.inputs.tasks == 'all-tasks' }}
    runs-on: ubuntu-latest
    name: Socket.io Real-time Communication
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: |
            backend/package-lock.json
            frontend/package-lock.json

      - name: Install dependencies
        run: |
          cd backend && npm ci
          cd ../frontend && npm ci

      - name: Run Claude Code for Socket.io
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: |
            Socket.ioã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚’å®Œå…¨ã«å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š
            1. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ã®ä»–ç«¯æœ«ã¸ã®å³åº§ã®åŒæœŸ
            2. ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•æ›´æ–°
            3. æ¥ç¶šçŠ¶æ…‹ã®ç®¡ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            4. è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸ
            5. æ¥ç¶šåˆ‡ã‚Œæ™‚ã®è‡ªå‹•å†æ¥ç¶šæ©Ÿèƒ½
          target-files: |
            backend/src/
            frontend/src/stores/
            frontend/src/hooks/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: implement Socket.io real-time communication"
          title: "Socket.io Real-time Communication"
          body: |
            ## Socket.io ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡
            
            - ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´ã®å³åº§åŒæœŸ
            - ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•æ›´æ–°
            - æ¥ç¶šçŠ¶æ…‹ç®¡ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            - è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸ
            
            ğŸ¤– Generated with Claude Code via GitHub Actions
          branch: feature/socket-realtime
          delete-branch: true

  responsive-design:
    if: ${{ github.event.inputs.tasks == 'responsive-design' || github.event.inputs.tasks == 'all-tasks' }}
    runs-on: ubuntu-latest
    name: Responsive Design Implementation
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        run: cd frontend && npm ci

      - name: Run Claude Code for Responsive Design
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: |
            ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š
            1. ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆæ¨ªå‘ãï¼ˆ1024x768ä»¥ä¸Šï¼‰ã§ã®ãƒ¡ã‚¤ãƒ³è¡¨ç¤º
            2. ç¸¦å‘ãã§ã‚‚ä½¿ç”¨å¯èƒ½ãªè¨­è¨ˆ
            3. ç•°ãªã‚‹ç”»é¢ã‚µã‚¤ã‚ºã§ã®ã‚°ãƒªãƒƒãƒ‰èª¿æ•´
            4. ã‚¿ãƒƒãƒæ“ä½œå¯¾å¿œã®æ”¹å–„
            5. ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã‚’ä½¿ã£ãŸæœ€é©åŒ–
          target-files: |
            frontend/src/
            frontend/tailwind.config.js
            frontend/src/index.css

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: implement responsive design"
          title: "Responsive Design Implementation"
          body: |
            ## ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
            
            - ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆæ¨ªå‘ã‘ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºå¯¾å¿œ
            - ç¸¦å‘ãã§ã‚‚ä½¿ç”¨å¯èƒ½ãªè¨­è¨ˆ
            - ç”»é¢ã‚µã‚¤ã‚ºã«å¿œã˜ãŸã‚°ãƒªãƒƒãƒ‰èª¿æ•´
            - ã‚¿ãƒƒãƒæ“ä½œã®æ”¹å–„
            
            ğŸ¤– Generated with Claude Code via GitHub Actions
          branch: feature/responsive-design
          delete-branch: true

  testing-setup:
    if: ${{ github.event.inputs.tasks == 'testing-setup' || github.event.inputs.tasks == 'all-tasks' }}
    runs-on: ubuntu-latest
    name: Testing Framework Setup
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.branch }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: |
            backend/package-lock.json
            frontend/package-lock.json

      - name: Install dependencies
        run: |
          cd backend && npm ci
          cd ../frontend && npm ci

      - name: Run Claude Code for Testing
        uses: anthropics/claude-code-action@v1
        with:
          anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
          task: |
            ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®è¨­å®šã¨åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š
            1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: Jest + React Testing Library
            2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Jest + Supertest
            3. E2Eãƒ†ã‚¹ãƒˆ: Playwright
            4. åŸºæœ¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
            5. CI/CDã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œè¨­å®š
          target-files: |
            backend/
            frontend/
            .github/workflows/

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat: setup testing framework"
          title: "Testing Framework Setup"
          body: |
            ## ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯è¨­å®š
            
            - Jest + React Testing Library (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
            - Jest + Supertest (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)
            - Playwright (E2Eãƒ†ã‚¹ãƒˆ)
            - åŸºæœ¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ
            
            ğŸ¤– Generated with Claude Code via GitHub Actions
          branch: feature/testing-setup
          delete-branch: true